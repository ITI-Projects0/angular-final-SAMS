<section
  class="w-full max-w-[1400px] p-6 bg-(--card) rounded-2xl border border-(--glass-border) shadow-xl backdrop-blur-xl text-(--text) md:p-4 mx-auto">
  <header class="flex flex-col gap-1 mb-6">
    <h2 class="text-2xl font-bold m-0">Groups</h2>
    <p class="text-(--muted) text-sm">Classes you manage across the center</p>
  </header>

  <div class="flex justify-between items-center my-3 gap-3 md:flex-col md:items-stretch md:gap-4">
    <input placeholder="Search groups..."
      class="px-3 py-2 rounded-lg border border-(--glass-border) w-[260px] bg-(--glass) text-(--text) md:w-full focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
      [(ngModel)]="searchTerm" />
    <button
      class="bg-linear-to-br from-(--primary) to-[#7c3aed] text-white rounded-full px-4 py-2 shadow-lg hover:-translate-y-0.5 hover:brightness-105 transition-all md:w-full font-semibold"
      type="button" *ngIf="canCreateGroup" (click)="openCreate()">Add group</button>
  </div>

  <div class="flex items-center gap-3 p-3 bg-(--glass) border border-(--glass-border) rounded-xl mb-2"
    *ngIf="loading">
    <div class="w-5 h-5 border-2 border-black/10 border-t-(--primary) rounded-full animate-spin"></div>
    <span>Loading courses...</span>
  </div>

  <div class="hidden lg:block">
    <table
      class="w-full border-collapse mt-2 bg-(--card) border border-(--glass-border) rounded-xl overflow-hidden shadow-lg">
      <thead>
        <tr>
          <th
            class="p-3 text-left border-b border-(--glass-border) bg-(--glass) font-bold text-(--muted)">
            Group</th>
          <th
            class="p-3 text-left border-b border-(--glass-border) bg-(--glass) font-bold text-(--muted)">
            Subject</th>
          <th
            class="p-3 text-left border-b border-(--glass-border) bg-(--glass) font-bold text-(--muted)">
            Teacher</th>
          <th
            class="p-3 text-right border-b border-(--glass-border) bg-(--glass) font-bold text-(--muted)">
            Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let group of filteredGroups">
          <td class="p-3 text-left border-b border-(--glass-border)">
            <div class="font-semibold">{{ group.title }}</div>
            <small class="text-(--muted) text-sm">{{ group.schedule }}</small>
          </td>
          <td class="p-3 text-left border-b border-(--glass-border)">{{ group.subject }}</td>
          <td class="p-3 text-left border-b border-(--glass-border)">{{ group.teacher }}</td>
          <td class="p-3 text-right border-b border-(--glass-border)">
            <button
              class="bg-(--glass) border border-(--glass-border) px-3 py-1.5 rounded-full cursor-pointer text-(--text) hover:bg-slate-400/10 hover:border-[#7c3aed]/35 hover:-translate-y-px transition-all"
              (click)="openInfo(group)">Overview</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="flex flex-col gap-4 mt-4 lg:hidden">
    <article
      class="border border-(--glass-border) rounded-2xl bg-(--card) p-4 shadow-md flex flex-col gap-3"
      *ngFor="let group of filteredGroups">
      <div class="flex items-start justify-between gap-3">
        <div>
          <p class="text-xs uppercase tracking-widest text-(--muted) mb-1">Group</p>
          <h3 class="text-lg font-semibold text-(--text) m-0">{{ group.title }}</h3>
          <p class="text-(--muted) text-sm">{{ group.schedule }}</p>
        </div>
        <span
          class="inline-flex items-center justify-center px-3 py-1 rounded-full text-xs border border-(--glass-border) bg-(--glass) text-(--muted) capitalize whitespace-nowrap"
          [class.border-emerald-500/40]="group.status === 'Active'"
          [class.bg-emerald-500/15]="group.status === 'Active'"
          [class.text-emerald-600]="group.status === 'Active'">{{ group.status }}</span>
      </div>

      <dl class="grid grid-cols-2 gap-3 text-sm text-(--muted)">
        <div>
          <dt class="font-semibold text-(--text)">Subject</dt>
          <dd class="m-0">{{ group.subject }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-(--text)">Teacher</dt>
          <dd class="m-0">{{ group.teacher }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-(--text)">Center</dt>
          <dd class="m-0">{{ group.center }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-(--text)">Students</dt>
          <dd class="m-0">{{ group.studentsCount || '—' }}</dd>
        </div>
      </dl>

      <button
        class="bg-(--glass) border border-(--glass-border) px-4 py-2 rounded-full cursor-pointer text-(--text) font-semibold hover:bg-white/5 hover:border-[#7c3aed]/35 transition-all"
        (click)="openInfo(group)">Overview</button>
    </article>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center items-center gap-4 mt-6 text-sm" *ngIf="meta && meta.last_page > 1">
    <button (click)="changePage(meta.current_page - 1)" [disabled]="meta.current_page === 1"
        class="px-3 py-1 rounded-lg border border-(--glass-border) bg-(--glass) hover:bg-(--primary) hover:text-white disabled:opacity-50 disabled:hover:bg-(--glass) disabled:hover:text-(--text) transition-all">
        Previous
    </button>
    <span class="text-(--muted)">Page {{ meta.current_page }} of {{ meta.last_page }}</span>
    <button (click)="changePage(meta.current_page + 1)" [disabled]="meta.current_page === meta.last_page"
        class="px-3 py-1 rounded-lg border border-(--glass-border) bg-(--glass) hover:bg-(--primary) hover:text-white disabled:opacity-50 disabled:hover:bg-(--glass) disabled:hover:text-(--text) transition-all">
        Next
    </button>
  </div>

</section>

<div
  *ngIf="panelOpen"
  class="fixed inset-0 bg-black/30 opacity-100 pointer-events-auto transition-opacity duration-200 z-60"
  (click)="closeInfo()">
</div>
<div
  class="fixed inset-y-0 right-0 w-full md:w-[min(420px,90vw)] bg-(--card) border-l border-(--glass-border) shadow-2xl transition-transform duration-300 p-5 flex flex-col gap-4 z-70"
  [class.translate-x-full]="!panelOpen" [class.translate-x-0]="panelOpen" (click)="$event.stopPropagation()">
  <div class="flex justify-between items-center font-bold">
    <h3 class="text-xl m-0">
      {{ panelMode === 'create' ? 'Create group' : panelMode === 'edit' ? 'Edit group' : 'Course info' }}
    </h3>
    <button
      class="border-none bg-transparent text-2xl cursor-pointer text-(--text) hover:opacity-70 transition-opacity"
      (click)="closeInfo()">X</button>
  </div>
  <div class="flex flex-col gap-3 flex-1 overflow-y-auto pb-4" *ngIf="panelMode === 'info' && selectedGroup">
    <p><strong>Group:</strong> {{ selectedGroup.title }}</p>
    <p><strong>Subject:</strong> {{ selectedGroup.subject }}</p>
    <p><strong>Schedule:</strong> {{ selectedGroup.schedule }}</p>
    <p><strong>Teacher:</strong> {{ selectedGroup.teacher }}</p>
    <p><strong>Students:</strong> {{ selectedGroup.studentsCount ?? '—' }}</p>

    <div class="mt-4 flex justify-end gap-2">
      <a class="bg-linear-to-br from-(--primary) to-[#7c3aed] text-white rounded-full px-4 py-2 shadow-lg hover:-translate-y-0.5 hover:brightness-105 transition-all font-semibold no-underline inline-block"
        [routerLink]="['/dashboard/staff/groups', selectedGroup.id]">Go to group</a>
      <button type="button"
        class="bg-(--glass) text-(--text) rounded-full px-4 py-2 border border-(--glass-border) cursor-pointer font-semibold hover:bg-white/5 hover:border-(--primary) transition-all"
        *ngIf="canCreateGroup" (click)="openEdit()">Edit</button>
      <button type="button"
        class="bg-red-500/10 text-red-500 rounded-full px-4 py-2 border border-red-500/40 cursor-pointer hover:-translate-y-0.5 hover:bg-red-500/20 hover:border-red-500/60 transition-all"
        *ngIf="canCreateGroup" (click)="deleteGroup()" [disabled]="processing">
        Delete
      </button>
    </div>
  </div>

  <div class="flex flex-col gap-3 flex-1 overflow-y-auto pb-4" *ngIf="panelMode === 'create' || panelMode === 'edit'">
    <div class="mb-2">
      <p class="text-sm text-(--muted) m-0">
        All fields with * are required. Update schedule days/time anytime after creating the group.
      </p>
    </div>

    <div class="block">
      <label class="block mb-2 text-sm font-medium text-(--muted)"><span
          class="text-red-500 mr-1">*</span>Name</label>
      <input
        class="w-full px-4 py-3 rounded-xl border border-(--glass-border) bg-white/5 text-(--text) shadow-inner focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
        type="text" [(ngModel)]="groupForm.name" placeholder="Group name" />
    </div>

    <div class="block">
      <label class="block mb-2 text-sm font-medium text-(--muted)"><span
          class="text-red-500 mr-1">*</span>Subject</label>
      <input
        class="w-full px-4 py-3 rounded-xl border border-(--glass-border) bg-white/5 text-(--text) shadow-inner focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
        type="text" [(ngModel)]="groupForm.subject" placeholder="Subject" />
    </div>

    <div class="block">
      <label class="block mb-2 text-sm font-medium text-(--muted)">Description</label>
      <textarea
        class="w-full px-4 py-3 rounded-xl border border-(--glass-border) bg-white/5 text-(--text) shadow-inner focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
        rows="3" [(ngModel)]="groupForm.description" placeholder="Optional description"></textarea>
    </div>

    <div class="block" *ngIf="panelMode === 'create'">
      <label class="block mb-2 text-sm font-medium text-(--muted)"><span class="text-red-500 mr-1">*</span>Schedule
        days</label>
      <div class="flex flex-wrap gap-2">
        <label *ngFor="let day of dayOptions"
          class="inline-flex items-center gap-2 px-3 py-2 rounded-full border border-(--glass-border) bg-(--glass) cursor-pointer font-semibold transition-all hover:-translate-y-px"
          [class.border-[#7c3aed]/40]="groupForm.scheduleDays.includes(day)"
          [class.bg-[#7c3aed]/10]="groupForm.scheduleDays.includes(day)"
          [class.shadow-lg]="groupForm.scheduleDays.includes(day)">
          <input type="checkbox" [checked]="groupForm.scheduleDays.includes(day)"
            (change)="toggleScheduleDay(day, $event)" class="pointer-events-none" />
          <span>{{ day }}</span>
        </label>
      </div>
      <p class="text-sm text-(--muted) mt-1">Selected: {{ groupForm.scheduleDays.length || 0 }}</p>
      <p class="text-sm text-red-500 mt-1" *ngIf="!groupForm.scheduleDays.length">Pick at least one day.</p>
    </div>

    <div class="grid grid-cols-[repeat(auto-fit,minmax(180px,1fr))] gap-3" *ngIf="panelMode === 'create'">
      <div>
        <label class="block mb-2 text-sm font-medium text-(--muted)">Schedule time</label>
        <input
          class="w-full px-4 py-3 rounded-xl border border-(--glass-border) bg-white/5 text-(--text) shadow-inner focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
          type="time" [(ngModel)]="groupForm.schedule_time" />
      </div>
      <div>
        <label class="block mb-2 text-sm font-medium text-(--muted)">Sessions count</label>
        <input
          class="w-full px-4 py-3 rounded-xl border border-(--glass-border) bg-white/5 text-(--text) shadow-inner focus:outline-none focus:border-(--primary) focus:ring-2 focus:ring-(--primary)/20 transition-all"
          type="number" min="1" max="100" [(ngModel)]="groupForm.sessions_count" />
      </div>
    </div>

    <div
      class="mt-4 flex justify-end gap-2 sticky bottom-0 pt-4 bg-linear-to-t from-(--card) via-(--card) to-transparent border-t border-(--glass-border)">
      <span class="text-sm text-red-500" *ngIf="saveError">{{ saveError }}</span>
      <button
        class="bg-linear-to-br from-(--primary) to-[#7c3aed] text-white rounded-full px-4 py-2 shadow-lg hover:-translate-y-0.5 hover:brightness-105 transition-all font-semibold disabled:opacity-60 disabled:cursor-not-allowed"
        type="button" (click)="submitGroup()"
        [disabled]="processing || !groupForm.name || !groupForm.subject || (panelMode === 'create' && !groupForm.scheduleDays.length)">
        {{ panelMode === 'edit' ? 'Save changes' : 'Create' }}
      </button>
    </div>
  </div>
</div>
