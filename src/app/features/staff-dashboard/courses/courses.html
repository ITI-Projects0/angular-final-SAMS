<section class="list-wrapper">
  <header class="list-header">
    <h2>Groups</h2>
    <p class="muted">Classes you manage across the center</p>
  </header>

  <div class="toolbar">
    <input placeholder="Search groups..." class="search" [(ngModel)]="searchTerm" />
    <button class="btn-primary" type="button" *ngIf="canCreateGroup" (click)="openCreate()">Add group</button>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading courses...</span>
  </div>

  <table class="list-table glass">
    <thead>
      <tr>
        <th>Group</th>
        <th>Subject</th>
        <th>Center</th>
        <th>Teacher</th>
        <th>Status</th>
        <th class="text-right">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let group of filteredGroups">
        <td>
          <div class="font-semibold">{{ group.title }}</div>
          <small class="muted">{{ group.schedule }}</small>
        </td>
        <td>{{ group.subject }}</td>
        <td>{{ group.center }}</td>
        <td>{{ group.teacher }}</td>
        <td>
          <span class="status-pill" [class.active]="group.status === 'Active'">{{ group.status }}</span>
        </td>
        <td class="text-right">
          <button class="btn-simple" (click)="openInfo(group)">Overview</button>
        </td>
      </tr>
    </tbody>
  </table>
</section>

<div class="overlay" [class.open]="panelOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="panelOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>
      {{ panelMode === 'create' ? 'Create group' : panelMode === 'edit' ? 'Edit group' : 'Course info' }}
    </h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="panelMode === 'info' && selectedGroup">
    <p><strong>Group:</strong> {{ selectedGroup.title }}</p>
    <p><strong>Subject:</strong> {{ selectedGroup.subject }}</p>
    <p><strong>Schedule:</strong> {{ selectedGroup.schedule }}</p>
    <p><strong>Teacher:</strong> {{ selectedGroup.teacher }}</p>
    <p><strong>Center:</strong> {{ selectedGroup.center }}</p>
    <p><strong>Status:</strong> {{ selectedGroup.status }}</p>
    <p><strong>Students:</strong> {{ selectedGroup.studentsCount ?? 'â€”' }}</p>

    <div class="panel-actions">
      <a class="btn-primary" [routerLink]="['/dashboard/staff/groups', selectedGroup.id]">Go to group</a>
      <button type="button" class="btn-secondary" *ngIf="canCreateGroup" (click)="openEdit()">Edit</button>
      <button type="button" class="btn-danger" *ngIf="canCreateGroup" (click)="deleteGroup()" [disabled]="processing">
        Delete
      </button>
    </div>
  </div>

  <div class="panel-body" *ngIf="panelMode === 'create' || panelMode === 'edit'">
    <div class="form-header">
      <p class="field-hint">
        All fields with * are required. Update schedule days/time anytime after creating the group.
      </p>
    </div>

    <div class="field">
      <label><span class="required">*</span>Name</label>
      <input class="input-control" type="text" [(ngModel)]="groupForm.name" placeholder="Group name" />
    </div>

    <div class="field">
      <label><span class="required">*</span>Subject</label>
      <input class="input-control" type="text" [(ngModel)]="groupForm.subject" placeholder="Subject" />
    </div>

    <div class="field">
      <label>Description</label>
      <textarea class="input-control" rows="3" [(ngModel)]="groupForm.description" placeholder="Optional description"></textarea>
    </div>

    <div class="field">
      <label><span class="required">*</span>Schedule days</label>
      <div class="day-grid">
        <label *ngFor="let day of dayOptions" class="day-pill" [class.checked]="groupForm.scheduleDays.includes(day)">
          <input
            type="checkbox"
            [checked]="groupForm.scheduleDays.includes(day)"
            (change)="toggleScheduleDay(day, $event)"
          />
          <span>{{ day }}</span>
        </label>
      </div>
      <p class="field-hint">Selected: {{ groupForm.scheduleDays.length || 0 }}</p>
      <p class="error-text" *ngIf="!groupForm.scheduleDays.length">Pick at least one day.</p>
    </div>

    <div class="field two-col">
      <div>
        <label>Schedule time</label>
        <input class="input-control" type="time" [(ngModel)]="groupForm.schedule_time" />
      </div>
      <div>
        <label>Sessions count</label>
        <input class="input-control" type="number" min="1" max="100" [(ngModel)]="groupForm.sessions_count" />
      </div>
    </div>

    <div class="panel-actions sticky-footer">
      <span class="error-text" *ngIf="saveError">{{ saveError }}</span>
      <button
        class="btn-primary"
        type="button"
        (click)="submitGroup()"
        [disabled]="processing || !groupForm.name || !groupForm.subject || !groupForm.scheduleDays.length">
        {{ panelMode === 'edit' ? 'Save changes' : 'Create' }}
      </button>
    </div>
  </div>
</div>
