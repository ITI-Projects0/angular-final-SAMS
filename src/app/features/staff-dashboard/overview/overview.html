<section class="dashboard-page">
  <div *ngIf="loading" class="dashboard-card" style="padding: 1rem; text-align: center; color: var(--muted);">
    Loading dashboard...
  </div>

  <div class="dashboard-card"
    style="padding: 1.5rem; display: grid; grid-template-columns: 1.4fr 1fr; gap: 1.5rem; align-items: center;">
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      <p style="text-transform: uppercase; letter-spacing: 0.18em; font-size: 0.75rem; color: var(--muted);">Teaching
        pulse</p>
      <h1 style="font-size: 1.875rem; font-weight: 800; color: var(--text);">Staff Overview</h1>
      <p style="color: var(--muted);">Snapshot of your groups, students, lessons, and attendance.</p>
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <button routerLink="/dashboard/staff/groups" class="btn-dashboard-primary">View groups</button>
        <button routerLink="/dashboard/staff/students" class="btn-dashboard-ghost">View students</button>
      </div>
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
        <span class="badge badge-neutral">Students: {{ stats.students }}</span>
        <span class="badge badge-success">Attendance today: {{ stats.attendanceToday }}</span>
        <span class="badge badge-neutral">Lessons scheduled: {{ stats.lessons }}</span>
      </div>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Groups</p>
        <p style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.groups }}</p>
        <span style="font-size: 0.875rem; color: var(--muted);">Active classes under your care</span>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Lessons</p>
        <p style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.lessons }}</p>
        <span style="font-size: 0.875rem; color: var(--muted);">Total scheduled lessons</span>
      </div>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
    <article class="dashboard-stat-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <div
          style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; color: var(--muted);">
          <span style="width: 10px; height: 10px; border-radius: 50%; background: #6366f1;"></span>
          Students
        </div>
        <span style="font-size: 0.75rem; color: var(--muted);">Enrolled</span>
      </div>
      <div style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.students }}</div>
      <p style="font-size: 0.875rem; color: var(--muted);">
        Attendance today: {{ stats.attendanceToday }}
      </p>
      <div
        style="margin-top: 0.75rem; width: 100%; height: 8px; border-radius: 9999px; background: var(--dashboard-sidebar-border); overflow: hidden;">
        <span
          style="display: block; height: 100%; border-radius: 9999px; background: linear-gradient(to right, #6366f1, #0ea5e9);"
          [style.width.%]="stats.students ? (stats.attendanceToday / stats.students) * 100 : 0"></span>
      </div>
    </article>

    <article class="dashboard-stat-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <div
          style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; color: var(--muted);">
          <span style="width: 10px; height: 10px; border-radius: 50%; background: #10b981;"></span>
          Lessons
        </div>
        <span style="font-size: 0.75rem; color: var(--muted);">Upcoming</span>
      </div>
      <div style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.lessons }}</div>
      <p style="font-size: 0.875rem; color: var(--muted);">Total sessions scheduled for all groups</p>
      <div
        style="margin-top: 0.75rem; width: 100%; height: 8px; border-radius: 9999px; background: var(--dashboard-sidebar-border); overflow: hidden;">
        <span
          style="display: block; height: 100%; border-radius: 9999px; background: linear-gradient(to right, #34d399, #2dd4bf);"></span>
      </div>
    </article>

    <article class="dashboard-stat-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <div
          style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; color: var(--muted);">
          <span style="width: 10px; height: 10px; border-radius: 50%; background: #fbbf24;"></span>
          Groups
        </div>
        <span style="font-size: 0.75rem; color: var(--muted);">Active</span>
      </div>
      <div style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.groups }}</div>
      <p style="font-size: 0.875rem; color: var(--muted);">Classes you're teaching or managing</p>
      <div
        style="margin-top: 0.75rem; width: 100%; height: 8px; border-radius: 9999px; background: var(--dashboard-sidebar-border); overflow: hidden;">
        <span
          style="display: block; height: 100%; border-radius: 9999px; background: linear-gradient(to right, #fbbf24, #fb923c);"></span>
      </div>
    </article>

    <article class="dashboard-stat-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <div
          style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; color: var(--muted);">
          <span style="width: 10px; height: 10px; border-radius: 50%; background: #f43f5e;"></span>
          Attendance
        </div>
        <span style="font-size: 0.75rem; color: var(--muted);">Today</span>
      </div>
      <div style="font-size: 1.875rem; font-weight: 800; color: var(--text);">{{ stats.attendanceToday }}</div>
      <p style="font-size: 0.875rem; color: var(--muted);">Attendance entries submitted today</p>
    </article>
  </div>

  <section *ngIf="isCenterAdmin && centerStats as summary" class="dashboard-card" style="padding: 1.5rem;">
    <div style="margin-bottom: 1rem;">
      <p style="text-transform: uppercase; letter-spacing: 0.18em; font-size: 0.75rem; color: var(--muted);">Center
        snapshot</p>
      <h2 style="font-size: 1.25rem; font-weight: 800; color: var(--text); margin: 0.25rem 0;">Members & lessons</h2>
      <p style="font-size: 0.875rem; color: var(--muted);">High level overview across the entire center.</p>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Teachers</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.teachers_count }}</p>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Assistants</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.assistants_count }}</p>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Groups</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.groups_count }}</p>
        <span style="font-size: 0.75rem; color: var(--muted);">Active: {{ summary.active_groups }}</span>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Students</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.students_count }}</p>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Parents</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.parents_count }}</p>
      </div>
      <div class="dashboard-stat-card">
        <p style="font-size: 0.875rem; color: var(--muted);">Lessons</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--text);">{{ summary.lessons_count }}</p>
      </div>
    </div>
  </section>

  <section *ngIf="isCenterAdmin">
    <app-center-ai-panel></app-center-ai-panel>
  </section>

  <section class="dashboard-card" style="padding: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <div>
        <p style="text-transform: uppercase; letter-spacing: 0.18em; font-size: 0.75rem; color: var(--muted);">Recent
          activity</p>
        <h2 style="font-size: 1.25rem; font-weight: 800; color: var(--text); margin: 0.25rem 0;">Latest group updates
        </h2>
      </div>
      <button routerLink="/dashboard/staff/groups" class="btn-dashboard-ghost">Open groups</button>
    </div>
    <ng-container *ngIf="recent.length; else emptyRecent">
      <ul style="display: flex; flex-direction: column; gap: 0.75rem;">
        <li *ngFor="let item of recent"
          style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--dashboard-sidebar-border);">
          <div style="display: flex; align-items: center; gap: 0.75rem; color: var(--text);">
            <span
              style="width: 10px; height: 10px; border-radius: 50%; background: linear-gradient(to right, #6366f1, #3b82f6);"></span>
            <span>{{ item.title || 'Activity' }}</span>
          </div>
          <span style="font-size: 0.875rem; color: var(--muted);">{{ item.time }}</span>
        </li>
      </ul>
    </ng-container>
    <ng-template #emptyRecent>
      <div style="font-size: 0.875rem; color: var(--muted);">No recent activity recorded.</div>
    </ng-template>
  </section>
</section>