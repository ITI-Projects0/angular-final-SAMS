<!-- لو الطالب موجود -->
<section class="student-info-wrapper" *ngIf="student as s">
  <div class="top-bar">
    <a routerLink="/dashboard/staff/students" class="back-btn">← Back to students</a>
  </div>

  <div class="card">
    <!-- Header: الصورة + البيانات الأساسية -->
    <div class="card-header">
      <div class="avatar-big">
        <img [src]="s.avatar" [alt]="s.name" />
      </div>

      <div class="main-info">
        <h1 class="name">{{ s.name }}</h1>
        <p class="role">{{ s.role }}</p>

        <span [ngClass]="getStatusBadgeClass(s.status)">
          {{ s.status }}
        </span>
      </div>
    </div>

    <div class="card-body">
      <!-- Info Grid -->
      <div class="info-grid">
        <div class="info-item">
          <p class="label">Age</p>
          <p class="value">{{ s.age }}</p>
        </div>
        <div class="info-item">
          <p class="label">Join Date</p>
          <p class="value">{{ s.date }}</p>
        </div>
        <div class="info-item">
          <p class="label">Email</p>
          <p class="value value-muted">{{ s.name | lowercase }}@example.com</p>
        </div>
      </div>

      <!-- Stats cards -->
      <div class="stats-row" *ngIf="totalSessions > 0">
        <div class="stat-card">
          <p class="stat-label">Total Sessions</p>
          <p class="stat-value">{{ totalSessions }}</p>
        </div>
        <div class="stat-card green">
          <p class="stat-label">Present</p>
          <p class="stat-value">{{ presentCount }}</p>
        </div>
        <div class="stat-card yellow">
          <p class="stat-label">Late</p>
          <p class="stat-value">{{ lateCount }}</p>
        </div>
        <div class="stat-card red">
          <p class="stat-label">Absent</p>
          <p class="stat-value">{{ absentCount }}</p>
        </div>
        <div class="stat-card blue">
          <p class="stat-label">Attendance %</p>
          <p class="stat-value">{{ attendancePercent }}%</p>
        </div>
      </div>

      <!-- Attendance History -->
      <div class="section" *ngIf="attendanceHistory.length > 0">
        <h2 class="section-title">Attendance history</h2>

        <div class="table-wrapper">
          <table class="simple-table">
            <thead>
              <tr>
                <th>Session</th>
                <th>Date</th>
                <th>Status</th>
                <th>Note</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let a of attendanceHistory">
                <td>{{ a.name }}</td>
                <td>{{ a.date }}</td>
                <td>
                  <span [ngClass]="getAttendanceBadgeClass(a.status)">
                    {{ a.status }}
                  </span>
                </td>
                <td class="muted">
                  {{ a.note || '—' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Class Management + Groups -->
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Classes / Groups</h2>

          <div class="class-actions">
            <select class="class-select" [(ngModel)]="selectedClass">
              <option value="">Select class...</option>
              <option *ngFor="let c of availableClasses" [value]="c">
                {{ c }}
              </option>
            </select>

            <button class="class-add-btn" (click)="addToClass()"
              [disabled]="!selectedClass || isInClass(selectedClass)">
              + Add to class
            </button>
          </div>
        </div>

        <div class="chip-list" *ngIf="groups.length > 0; else noGroups">
          <div class="group-chip" *ngFor="let g of groups">
            <div>
              <span class="group-name">{{ g.name }}</span>
              <span class="group-role">{{ g.role }}</span>
            </div>
            <button type="button" class="chip-remove-btn" (click)="removeFromClass(g.name)">
              ✕
            </button>
          </div>
        </div>

        <ng-template #noGroups>
          <p class="muted-text">This student is not assigned to any class yet.</p>
        </ng-template>
      </div>

      <!-- Parents / Contacts -->
      <div class="section" *ngIf="parents.length > 0">
        <h2 class="section-title">Parents & Contacts</h2>

        <div class="parents-grid">
          <div class="parent-card" *ngFor="let p of parents">
            <div class="parent-header">
              <div class="parent-avatar">
                {{ p.name[0] || '?' }}
              </div>
              <div>
                <p class="parent-name">{{ p.name }}</p>
                <p class="parent-relation">{{ p.relation }}</p>
              </div>
            </div>

            <div class="parent-info-row">
              <span class="parent-label">Phone</span>
              <a class="parent-value" [href]="'tel:' + p.phone">
                {{ p.phone }}
              </a>
            </div>

            <div class="parent-info-row">
              <span class="parent-label">Email</span>
              <a class="parent-value" [href]="'mailto:' + p.email">
                {{ p.email }}
              </a>
            </div>

            <div class="parent-actions">
              <a class="parent-btn" [href]="'tel:' + p.phone">
                Call
              </a>
              <a class="parent-btn secondary" [href]="'mailto:' + p.email">
                Email
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Grades -->
      <div class="section" *ngIf="grades.length > 0">
        <h2 class="section-title">Courses & Grades</h2>

        <div class="table-wrapper small">
          <table class="simple-table">
            <thead>
              <tr>
                <th>Subject</th>
                <th>Score</th>
                <th>Letter</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let g of grades">
                <td>{{ g.subject }}</td>
                <td>{{ g.score }}</td>
                <td>{{ g.letter }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Notes -->
      <div class="section">
        <h2 class="section-title">Notes</h2>
        <p class="section-text">
          This profile is using static/mock data for now. Later you can connect it
          to your real backend (API) and show live attendance, grades, groups and parents data per student.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- لو مفيش طالب -->
<section class="student-info-wrapper" *ngIf="!student">
  <div class="top-bar">
    <a routerLink="/dashboard/staff/students" class="back-btn">← Back to students</a>
  </div>
  <p>No student found.</p>
</section>
