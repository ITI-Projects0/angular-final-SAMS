<section class="dashboard-page">
  <header class="dashboard-header">
    <h2>{{ isCenterAdmin ? (activeRole === 'teacher' ? 'Teachers' : 'Assistants') : 'Teachers' }}</h2>
    <p>
      {{ isCenterAdmin ? 'Manage staff assigned to this center' : 'Teaching staff and their assigned centers' }}
    </p>
  </header>

  <div class="dashboard-toolbar">
    <input placeholder="Search teachers..." class="dashboard-input" style="max-width: 300px;" [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange($event)" />
    <div class="toolbar-actions" *ngIf="isCenterAdmin">
      <div class="segment">
        <button type="button" [class.active]="activeRole === 'teacher'"
          (click)="setRoleFilter('teacher')">Teachers</button>
        <button type="button" [class.active]="activeRole === 'assistant'"
          (click)="setRoleFilter('assistant')">Assistants</button>
      </div>
      <button class="btn-dashboard-primary" type="button" (click)="openCreate('teacher')"
        *ngIf="activeRole === 'teacher'">
        Add Teacher
      </button>
      <button class="btn-dashboard-primary" type="button" (click)="openCreate('assistant')"
        *ngIf="activeRole === 'assistant'">
        Add Assistant
      </button>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading teachers...</span>
  </div>

  <div class="dashboard-table-wrapper" *ngIf="filteredTeachers.length; else noResults">
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Role</th>
          <th>Phone</th>
          <th>Stats</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of filteredTeachers">
          <td>
            <div class="stack">
              <span class="strong">{{ t.name }}</span>
              <span class="muted">{{ t.email }}</span>
            </div>
          </td>
          <td>
            <span class="badge badge-neutral">{{ activeRole | titlecase }}</span>
          </td>
          <td>
            <span class="muted">{{ t.phone || '-' }}</span>
          </td>
          <td>
            <span class="badge badge-neutral">{{ t.courses }} courses</span>
          </td>
          <td>
            <button class="btn-dashboard-ghost" (click)="openInfo(t)">Info</button>
            <button class="btn-dashboard-ghost" *ngIf="isCenterAdmin" (click)="openEdit(t)">Edit</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" *ngIf="filteredTeachers.length">
    <div class="muted small">Showing {{ pageStart }}â€“{{ pageEnd }} of {{ totalItems }}</div>
    <div class="page-controls">
      <button type="button" class="btn-dashboard-ghost" [disabled]="page <= 1"
        (click)="goToPage(page - 1)">Prev</button>
      <span class="page-indicator">Page {{ page }} / {{ totalPages }}</span>
      <button type="button" class="btn-dashboard-ghost" [disabled]="page >= totalPages"
        (click)="goToPage(page + 1)">Next</button>
    </div>
  </div>

  <ng-template #noResults>
    <div class="empty-state">
      <p>No staff found.</p>
    </div>
  </ng-template>
</section>

<div class="overlay" [class.open]="panelOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="panelOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>{{ panelTitle }}</h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="panelMode === 'info' && selectedTeacher">
    <p><strong>Name:</strong> {{ selectedTeacher.name }}</p>
    <p><strong>Email:</strong> {{ selectedTeacher.email }}</p>
    <p><strong>Center:</strong> {{ selectedTeacher.center || '-' }}</p>
    <p><strong>Courses taught:</strong> {{ selectedTeacher.courses }}</p>
    <p><strong>Phone:</strong> {{ selectedTeacher.phone || '-' }}</p>
    <p><strong>User ID:</strong> {{ selectedTeacher.id }}</p>
    <p class="error-text" *ngIf="saveError">{{ saveError }}</p>
    <div class="panel-actions" *ngIf="isCenterAdmin">
      <button class="btn-primary" type="button" (click)="openEdit(selectedTeacher)">Edit</button>
      <button class="btn-danger" type="button" (click)="deleteSelected()" [disabled]="processing">Delete</button>
    </div>
  </div>

  <div class="panel-body" *ngIf="panelMode !== 'info'">
    <p class="field-hint">Fields marked with * are required.</p>
    <p class="error-banner" *ngIf="saveError">{{ saveError }}</p>
    <div class="field">
      <label><span class="required">*</span>Name</label>
      <input list="staff-name-suggestions" class="input-control" type="text" [(ngModel)]="form.name"
        placeholder="Full name" />
      <datalist id="staff-name-suggestions">
        <option *ngFor="let name of staffNames" [value]="name"></option>
      </datalist>
    </div>
    <div class="field">
      <label><span class="required">*</span>Email</label>
      <input class="input-control" type="email" [(ngModel)]="form.email" placeholder="Email address" />
    </div>
    <div class="field">
      <label>Phone</label>
      <input class="input-control" type="text" [(ngModel)]="form.phone" placeholder="Optional phone" />
    </div>
    <div class="field" *ngIf="panelMode === 'create'">
      <label>Role</label>
      <div class="segment">
        <button type="button" [class.active]="form.role === 'teacher'" (click)="form.role = 'teacher'">Teacher</button>
        <button type="button" [class.active]="form.role === 'assistant'"
          (click)="form.role = 'assistant'">Assistant</button>
      </div>
    </div>
    <p class="error-text" *ngIf="saveError">{{ saveError }}</p>
    <div class="panel-actions sticky-footer">
      <button class="btn-primary" type="button" (click)="submitForm()" [disabled]="processing || !canSubmitForm">
        {{ panelMode === 'create' ? 'Create' : 'Save changes' }}
      </button>
      <button class="btn-danger" type="button" *ngIf="panelMode === 'edit'" (click)="deleteSelected()"
        [disabled]="processing">
        Delete
      </button>
    </div>
  </div>
</div>