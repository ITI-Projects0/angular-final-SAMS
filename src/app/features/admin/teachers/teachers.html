<section class="dashboard-page">
  <header class="dashboard-header">
    <h2>Teachers</h2>
    <p>Teaching staff and their assigned centers</p>
  </header>

  <div class="dashboard-toolbar">
    <input placeholder="Search teachers..." class="dashboard-input" style="max-width: 300px;" [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange()" />
    <div class="toolbar-actions">
      <label class="dashboard-label" style="margin: 0;">Per page</label>
      <select class="dashboard-select" style="width: auto;" [(ngModel)]="perPage"
        (ngModelChange)="changePerPage($event)">
        <option [ngValue]="10">10</option>
        <option [ngValue]="15">15</option>
        <option [ngValue]="25">25</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading teachers...</span>
  </div>

  <div class="dashboard-table-wrapper">
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Teacher</th>
          <th>Center</th>
          <th>Stats</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of filteredTeachers">
          <td>
            <div class="stack">
              <span class="strong">{{ t.name }}</span>
              <span class="muted">{{ t.email }}</span>
            </div>
          </td>
          <td><span class="badge badge-neutral">{{ t.center || '-' }}</span></td>
          <td>
            <div class="flex gap-2">
              <span class="badge badge-neutral">{{ t.courses }} courses</span>
              <span class="badge badge-neutral">{{ t.totalStudents }} students</span>
            </div>
          </td>
          <td>
            <span class="badge" [ngClass]="t.status === 'active' ? 'badge-success' : 'badge-neutral'">
              {{ t.status }}
            </span>
          </td>
          <td>
            <button class="btn-dashboard-ghost" (click)="openInfo(t)">Info</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" *ngIf="lastPage > 1 || total">
    <div class="muted small">Showing {{ rangeStart }} - {{ rangeEnd }} of {{ total }}</div>
    <div class="page-controls">
      <button class="btn-dashboard-ghost" [disabled]="page === 1" (click)="changePage(page - 1)">Prev</button>
      <span class="page-indicator">Page {{ page }} / {{ lastPage }}</span>
      <button class="btn-dashboard-ghost" [disabled]="page === lastPage" (click)="changePage(page + 1)">Next</button>
    </div>
  </div>
</section>

<div class="overlay" [class.open]="infoOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="infoOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>Teacher info</h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="selectedTeacher">
    <p><strong>Name:</strong> {{ selectedTeacher.name }}</p>
    <p><strong>Email:</strong> {{ selectedTeacher.email }}</p>
    <div class="chips">
      <div class="chip">Center: {{ selectedTeacher.center || '-' }}</div>
      <div class="chip">Courses: {{ selectedTeacher.courses }}</div>
      <div class="chip">Phone: {{ selectedTeacher.phone || '-' }}</div>
      <div class="chip" [ngClass]="selectedTeacher.status === 'active' ? 'pill-success' : 'pill-muted'">
        Status: {{ selectedTeacher.status }}
      </div>
      <div class="chip students-pill">
        Total students: {{ selectedTeacher.totalStudents }}
      </div>
    </div>
    <!-- <p><strong>Role tags:</strong> {{ selectedTeacher.raw?.roles?.map((r: any) => r?.name || r).join(', ') || selectedTeacher.raw?.role || 'teacher' }}</p> -->
    <p><strong>User ID:</strong> {{ selectedTeacher.id }}</p>
    <div *ngIf="selectedTeacher.courseList.length">
      <p><strong>Courses:</strong></p>
      <div class="chips">
        <div class="chip" *ngFor="let c of selectedTeacher.courseList">
          <div class="chip-title">{{ c.name }}</div>
          <div class="chip-meta">
            <span *ngIf="c.center">{{ c.center }}</span>
            <span class="dot"></span>
            <span>{{ c.studentsCount }} students</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>