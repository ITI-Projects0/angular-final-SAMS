<section
  class="max-w-[1100px] mx-auto my-6 p-5 max-[400px]:p-3 bg-[var(--card)] rounded-2xl border border-[var(--glass-border)] shadow-[0_18px_40px_rgba(0,0,0,0.08)] backdrop-blur-xl text-[var(--text)]">
  <header class="mb-4">
    <h2 class="text-2xl font-bold">Teachers</h2>
    <p class="text-[var(--muted)] text-sm">Manage teachers and view their stats</p>
  </header>

  <div class="flex justify-between items-center my-3 gap-3 max-[500px]:flex-col max-[500px]:items-stretch">
    <input placeholder="Search teachers..."
      class="px-3 py-2 rounded-lg border border-[var(--glass-border)] w-[260px] bg-[var(--glass)] text-[var(--text)] max-[500px]:w-full focus:outline-none focus:border-[var(--primary)] transition-colors"
      [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />
    <div class="inline-flex items-center max-[500px]:justify-between gap-2">
      <label class="text-[var(--muted)] text-sm">Per page</label>
      <select
        class="px-2.5 py-1.5 rounded-lg border border-[var(--glass-border)] bg-[var(--glass)] text-[var(--text)] focus:outline-none"
        [(ngModel)]="perPage" (ngModelChange)="changePerPage(perPage)">
        <option [ngValue]="10">10</option>
        <option [ngValue]="15">15</option>
        <option [ngValue]="25">25</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
  </div>

  <div class="flex items-center gap-2.5 p-3 bg-[var(--glass)] border border-[var(--glass-border)] rounded-xl mb-2"
    *ngIf="loading">
    <div class="w-[18px] h-[18px] border-[3px] border-black/10 border-t-[var(--primary)] rounded-full animate-spin">
    </div>
    <span>Loading teachers...</span>
  </div>

  <table
    class="w-full border-collapse mt-2.5 bg-[var(--card)] border border-[var(--glass-border)] rounded-xl overflow-hidden shadow-sm max-[1200px]:block max-[1200px]:bg-transparent max-[1200px]:border-none max-[1200px]:shadow-none">
    <thead class="max-[1200px]:hidden">
      <tr>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Name</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Email</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Phone</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Center</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Status</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Students</th>
        <th class="p-3 text-left border-b border-[var(--glass-border)] bg-[var(--glass)] font-bold text-[var(--muted)]">
          Actions</th>
      </tr>
    </thead>
    <tbody
      class="max-[1200px]:grid max-[1200px]:grid-cols-[repeat(auto-fill,minmax(240px,1fr))] max-[1200px]:gap-4 max-[1200px]:w-full">
      <tr *ngFor="let t of filteredTeachers"
        class="max-[1200px]:flex max-[1200px]:flex-col max-[1200px]:bg-[var(--card)] max-[1200px]:border max-[1200px]:border-[var(--glass-border)] max-[1200px]:rounded-2xl max-[1200px]:p-4 max-[400px]:p-3 max-[1200px]:shadow-sm max-[1200px]:h-full">
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle font-bold text-[var(--text)] max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Name">
          <span class="font-bold text-[var(--text)]">{{ t.name }}</span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:gap-4 max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Email">
          <span class="text-[var(--text)] text-sm">{{ t.email }}</span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:gap-4 max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Phone">
          <span class="text-[var(--text)] text-sm">{{ t.phone || '-' }}</span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:gap-4 max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Center">
          <span
            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-[var(--glass)] border border-[var(--glass-border)] text-sm truncate max-w-[220px] max-[1200px]:max-w-full"
            title="{{ t.center || '-' }}">{{ t.center || '-' }}</span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:gap-4 max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Status">
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-sm"
            [ngClass]="t.status === 'active' ? 'bg-[#ecfdf3] text-[#15803d] border-[#bbf7d0]' : 'bg-[#f3f4f6] text-[#4b5563] border-transparent'">
            {{ t.status }}
          </span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-between max-[1200px]:items-center max-[1200px]:gap-4 max-[1200px]:w-full max-[1200px]:py-3 max-[1200px]:px-0 max-[1200px]:text-right max-[1200px]:before:content-[attr(data-label)] max-[1200px]:before:font-semibold max-[1200px]:before:text-[var(--muted)] max-[1200px]:before:mr-auto max-[1200px]:before:text-left"
          data-label="Students">
          <span
            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-[#eff6ff] text-[#0f172a] border border-[#bfdbfe] text-sm">{{
            t.totalStudents }} students</span>
        </td>
        <td
          class="p-3 border-b border-[var(--glass-border)] align-middle max-[1200px]:flex max-[1200px]:justify-center max-[1200px]:items-center max-[1200px]:w-full max-[1200px]:pt-4 max-[1200px]:pb-0 max-[1200px]:mt-auto max-[1200px]:border-none"
          data-label="Actions">
          <button
            class="bg-[var(--glass)] border border-[var(--glass-border)] px-3.5 py-1.5 rounded-full cursor-pointer text-[var(--text)] shadow-sm hover:-translate-y-px hover:bg-purple-500/10 hover:border-purple-500/30 hover:shadow-md transition-all duration-200"
            (click)="openInfo(t)">Info</button>
        </td>
      </tr>
    </tbody>
  </table>

</section>

<div
  class="max-w-[1100px] mx-auto flex justify-between items-center mt-4 gap-3 bg-[var(--glass)] border border-[var(--glass-border)] p-2.5 rounded-xl max-[450px]:flex-col max-[450px]:items-center"
  *ngIf="lastPage > 1 || total">
  <div class="text-[var(--muted)] text-sm">Showing {{ rangeStart }} - {{ rangeEnd }} of {{ total }}</div>
  <div class="inline-flex items-center gap-2.5">
    <button
      class="bg-[var(--glass)] border border-[var(--glass-border)] px-3.5 py-1.5 rounded-full cursor-pointer text-[var(--text)] shadow-sm hover:-translate-y-px hover:bg-purple-500/10 hover:border-purple-500/30 hover:shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:transform-none"
      [disabled]="page === 1" (click)="changePage(page - 1)">Prev</button>
    <span class="font-bold">Page {{ page }} / {{ lastPage }}</span>
    <button
      class="bg-[var(--glass)] border border-[var(--glass-border)] px-3.5 py-1.5 rounded-full cursor-pointer text-[var(--text)] shadow-sm hover:-translate-y-px hover:bg-purple-500/10 hover:border-purple-500/30 hover:shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:transform-none"
      [disabled]="page === lastPage" (click)="changePage(page + 1)">Next</button>
  </div>
</div>

<div class="fixed inset-0 bg-black/20 opacity-0 pointer-events-none transition-opacity duration-250"
  [class.opacity-100]="infoOpen" [class.pointer-events-auto]="infoOpen" (click)="closeInfo()"></div>
<div
  class="fixed inset-y-0 right-0 w-[min(420px,90vw)] max-[640px]:w-full bg-[var(--card)] border-l border-[var(--glass-border)] shadow-[-8px_0_24px_rgba(0,0,0,0.18)] transition-transform duration-300 p-5 flex flex-col gap-3.5 z-[999]"
  [ngClass]="infoOpen ? 'translate-x-0' : 'translate-x-full'" (click)="$event.stopPropagation()">
  <div class="flex justify-between items-center font-bold">
    <h3>Teacher Details</h3>
    <button class="border-none bg-transparent text-2xl cursor-pointer text-[var(--text)]"
      (click)="closeInfo()">X</button>
  </div>
  <div class="flex flex-col gap-2.5" *ngIf="selectedTeacher">
    <div class="flex items-center gap-3">
      <div
        class="w-11 h-11 rounded-full bg-[#eef2ff] flex items-center justify-center font-bold text-[#1e3a8a] text-lg">
        {{ selectedTeacher.name.charAt(0).toUpperCase() }}
      </div>
      <div>
        <p class="font-bold text-[var(--text)]">{{ selectedTeacher.name }}</p>
        <p class="text-[var(--muted)] text-sm">{{ selectedTeacher.email }}</p>
      </div>
    </div>

    <div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-2 mt-2">
      <div class="p-2.5 border border-[var(--glass-border)] rounded-xl bg-[var(--glass)]">Center: {{
        selectedTeacher.center || '-' }}</div>
      <div class="p-2.5 border border-[var(--glass-border)] rounded-xl bg-[var(--glass)]">Phone: {{
        selectedTeacher.phone || '-' }}</div>
      <div class="p-2.5 border border-[var(--glass-border)] rounded-xl bg-[var(--glass)]">Total Students: {{
        selectedTeacher.totalStudents }}</div>
      <div class="p-2.5 border border-[var(--glass-border)] rounded-xl bg-[var(--glass)]">Pending: {{
        selectedTeacher.pendingStudents }}</div>
    </div>

    <div *ngIf="selectedTeacher.courseList.length" class="mt-2">
      <p class="font-bold mb-2">Courses ({{ selectedTeacher.courses }}):</p>
      <div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-2">
        <div class="p-2.5 border border-[var(--glass-border)] rounded-xl bg-[var(--glass)] shadow-sm"
          *ngFor="let c of selectedTeacher.courseList">
          <div class="font-bold mb-0.5">{{ c.name }}</div>
          <div class="text-sm text-[var(--muted)] flex items-center gap-1.5">
            <span *ngIf="c.center">{{ c.center }}</span>
            <span class="w-1.5 h-1.5 rounded-full bg-[var(--muted)] inline-block"></span>
            <span>{{ c.studentsCount }} students</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 pt-4 border-t border-[var(--glass-border)]">
      <button
        class="w-full bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-2 rounded-xl font-bold hover:bg-red-500/20 transition-colors cursor-pointer"
        (click)="deleteUser(selectedTeacher.id)">
        Delete Teacher
      </button>
    </div>
  </div>
</div>