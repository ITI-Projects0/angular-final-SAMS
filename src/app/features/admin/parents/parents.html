<section class="list-wrapper">
  <header class="list-header">
    <h2>Parents</h2>
    <p class="muted">Parent accounts linked to students</p>
  </header>

  <div class="toolbar">
    <input placeholder="Search parents..." class="search" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />
    <div class="toolbar-actions">
      <label class="muted">Per page</label>
      <select class="select" [(ngModel)]="perPage" (ngModelChange)="changePerPage($event)">
        <option [ngValue]="10">10</option>
        <option [ngValue]="15">15</option>
        <option [ngValue]="25">25</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading parents...</span>
  </div>

  <table class="list-table glass">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Children</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of filteredParents">
        <td class="strong">{{ p.name }}</td>
        <td class="muted">{{ p.email }}</td>
        <td>{{ p.phone || '-' }}</td>
        <td><span class="pill pill-ghost">{{ p.childCount }} kids</span></td>
        <td><span class="pill" [ngClass]="p.status === 'active' ? 'pill-success' : 'pill-muted'">{{ p.status }}</span>
        </td>
        <td>
          <button class="btn-simple" (click)="openInfo(p)">Info</button>
        </td>
      </tr>
    </tbody>
  </table>

</section>
<div class="pagination" *ngIf="lastPage > 1 || total">
  <div class="muted small">Showing {{ rangeStart }} - {{ rangeEnd }} of {{ total }}</div>
  <div class="page-controls">
    <button class="btn-simple" [disabled]="page === 1" (click)="changePage(page - 1)">Prev</button>
    <span class="page-indicator">Page {{ page }} / {{ lastPage }}</span>
    <button class="btn-simple" [disabled]="page === lastPage" (click)="changePage(page + 1)">Next</button>
  </div>
</div>

<div class="overlay" [class.open]="infoOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="infoOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>Parent info</h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="selectedParent">
    <p><strong>Name:</strong> {{ selectedParent.name }}</p>
    <p><strong>Email:</strong> {{ selectedParent.email }}</p>
    <p><strong>Phone:</strong> {{ selectedParent.phone || '-' }}</p>
    <p><strong>Status:</strong> {{ selectedParent.status }}</p>
    <p><strong>User ID:</strong> {{ selectedParent.id }}</p>
    <div *ngIf="selectedParent.children?.length">
      <p><strong>Children:</strong></p>
      <div class="chips vertical">
        <div class="chip" *ngFor="let child of selectedParent.children">
          <div class="chip-title">{{ child.name }}</div>
          <div class="chip-meta">{{ child.email }}</div>
          <div *ngIf="child.courses?.length" class="child-courses">
            <div class="chip-subtitle">Courses</div>
            <ul>
              <li *ngFor="let c of child.courses">
                {{ c.name }} <span *ngIf="c.center">({{ c.center }})</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
