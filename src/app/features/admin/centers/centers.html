<section class="dashboard-page">
  <header class="dashboard-header">
    <h2>Centers</h2>
    <p>Manage all registered centers</p>
  </header>

  <div class="dashboard-toolbar">
    <input placeholder="Search centers..." class="dashboard-input" style="max-width: 300px;" [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange()" />
    <div class="toolbar-actions">
      <button class="btn-dashboard-primary" (click)="openForm()">Add center</button>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading centers...</span>
  </div>

  <div class="dashboard-table-wrapper">
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>City</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of filteredCenters">
          <td>
            <div class="stack">
              <span class="strong">{{ c.name }}</span>
              <span class="muted">{{ c.phone }}</span>
            </div>
          </td>
          <td><span class="badge badge-neutral">{{ c.city || '-' }}</span></td>
          <td><span class="badge" [ngClass]="c.paid ? 'badge-success' : 'badge-neutral'">{{ c.paid ? 'Active' :
              'Inactive' }}</span></td>
          <td>
            <button class="btn-dashboard-ghost" (click)="openInfo(c)">Info</button>
            <button class="btn-dashboard-ghost" (click)="openForm(c)">Edit</button>
            <button class="btn-dashboard-ghost text-red" (click)="delete(c)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <app-pagination [page]="page" [perPage]="perPage" [total]="total" [lastPage]="lastPage"
    (pageChange)="onPageChange($event)" (perPageChange)="onPerPageChange($event)">
  </app-pagination>
</section>

<!-- overlay form -->
<div class="overlay" [class.open]="isFormOpen" (click)="closeForm()"></div>
<div class="dashboard-form-panel" [class.open]="isFormOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>{{ isEditMode ? 'Edit center' : 'Add center' }}</h3>
    <button class="close-btn" (click)="closeForm()">X</button>
  </div>
  <form class="panel-body" (ngSubmit)="save()">
    <label class="dashboard-label">Center Name</label>
    <input class="dashboard-input" name="name" [(ngModel)]="formCenter.name" required />

    <label class="dashboard-label">Subdomain (City)</label>
    <input class="dashboard-input" name="city" [(ngModel)]="formCenter.city" required />

    <label class="dashboard-label">Owner Phone</label>
    <input class="dashboard-input" name="phone" [(ngModel)]="formCenter.phone" required />

    <label class="dashboard-label">Status</label>
    <select class="dashboard-select" name="paid" [(ngModel)]="formCenter.paid">
      <option [ngValue]="true">Active</option>
      <option [ngValue]="false">Inactive</option>
    </select>

    <button type="submit" class="btn-dashboard-primary full">{{ isEditMode ? 'Save Changes' : 'Create Center'
      }}</button>
  </form>
</div>

<div class="overlay" [class.open]="infoOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="infoOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>Center Details</h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="selectedCenter">
    <p><strong>Name:</strong> {{ selectedCenter.name }}</p>
    <p><strong>City:</strong> {{ selectedCenter.city }}</p>
    <p><strong>Phone:</strong> {{ selectedCenter.phone }}</p>
    <p><strong>Status:</strong> {{ selectedCenter.paid ? 'Active' : 'Inactive' }}</p>
    <p><strong>ID:</strong> {{ selectedCenter.id }}</p>
    <div *ngIf="selectedCenter.courses?.length">
      <p><strong>Courses:</strong></p>
      <div class="chips">
        <div class="chip" *ngFor="let c of selectedCenter.courses">
          <div class="chip-title">{{ c.name }}</div>
          <div class="chip-meta">
            <span *ngIf="c.teacher">Teacher: {{ c.teacher }}</span>
            <span class="dot"></span>
            <span>{{ c.studentsCount }} students</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>