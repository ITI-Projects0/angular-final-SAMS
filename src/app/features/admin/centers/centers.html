<section class="list-wrapper">
  <header class="list-header">
    <h2>Centers</h2>
    <p class="muted">All registered centers with payment status</p>
  </header>

  <div class="toolbar">
    <input placeholder="Search centers..." class="search" [(ngModel)]="searchTerm" />
    <button class="btn-primary" (click)="openForm()">Add center</button>
  </div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <span>Loading centers...</span>
  </div>

  <table class="list-table glass">
    <thead>
      <tr><th>Name</th><th>City</th><th>Phone</th><th>Status</th><th>Actions</th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of filteredCenters">
        <td>{{ c.name }}</td>
        <td>{{ c.city }}</td>
        <td>{{ c.phone }}</td>
        <td>
          <span [class.paid]="c.paid">{{ c.paid ? 'Paid' : 'Unpaid' }}</span>
        </td>
        <td>
          <button class="btn-simple" (click)="openInfo(c)">Info</button>
          <button class="btn-simple" (click)="openForm(c)">Edit</button>
          <button class="btn-simple muted" (click)="delete(c)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</section>

<!-- overlay form -->
<div class="overlay" [class.open]="isFormOpen" (click)="closeForm()"></div>
<div class="side-panel glass" [class.open]="isFormOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>{{ isEditMode ? 'Edit' : 'Add center' }}</h3>
    <button class="close-btn" (click)="closeForm()">X</button>
  </div>
  <form class="panel-body" (ngSubmit)="save()">
    <label class="label">Name</label>
    <input class="input" name="name" [(ngModel)]="formCenter.name" required />

    <label class="label">City</label>
    <input class="input" name="city" [(ngModel)]="formCenter.city" required />

    <label class="label">Phone</label>
    <input class="input" name="phone" [(ngModel)]="formCenter.phone" required />

    <label class="label">Status</label>
    <select class="input" name="paid" [(ngModel)]="formCenter.paid">
      <option [ngValue]="true">Paid</option>
      <option [ngValue]="false">Unpaid</option>
    </select>

    <button type="submit" class="btn-primary full">{{ isEditMode ? 'Edit' : 'Add center' }}</button>
  </form>
</div>

<div class="overlay" [class.open]="infoOpen" (click)="closeInfo()"></div>
<div class="side-panel glass" [class.open]="infoOpen" (click)="$event.stopPropagation()">
  <div class="panel-header">
    <h3>Center info</h3>
    <button class="close-btn" (click)="closeInfo()">X</button>
  </div>
  <div class="panel-body" *ngIf="selectedCenter">
    <p><strong>Name:</strong> {{ selectedCenter.name }}</p>
    <p><strong>Subdomain:</strong> {{ selectedCenter.city || '-' }}</p>
    <p><strong>Phone:</strong> {{ selectedCenter.phone || '-' }}</p>
    <p><strong>Status:</strong> {{ selectedCenter.paid ? 'Paid' : 'Unpaid' }}</p>
    <p><strong>Center ID:</strong> {{ selectedCenter.id }}</p>
    <div *ngIf="selectedCenter.courses?.length">
      <p><strong>Courses:</strong></p>
      <div class="chips">
        <div class="chip" *ngFor="let c of selectedCenter.courses">
          <div class="chip-title">{{ c.name }}</div>
          <div class="chip-meta">
            <span *ngIf="c.teacher">Teacher: {{ c.teacher }}</span>
            <span class="dot"></span>
            <span>{{ c.studentsCount }} students</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
