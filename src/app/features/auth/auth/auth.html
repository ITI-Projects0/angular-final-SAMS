<div
  class="relative w-full min-h-screen flex items-center bg-primary transition-colors duration-300 dark:bg-neutral-900">

  <!-- Background -->
  <div id="background" class="bg-secondary"></div>

  <!-- Theme Toggle -->
  <button (click)="themeService.toggle()" class="absolute top-4 right-4 z-50 p-3 w-10 h-10 rounded-full bg-white dark:bg-neutral-700 
           shadow-md text-neutral-800 dark:text-white transition-transform hover:scale-110
           flex items-center justify-center">
    <i class="fa-solid" [ngClass]="{ 'fa-moon': !themeService.darkMode(), 'fa-sun': themeService.darkMode() }">
    </i>
  </button>

  <!-- Logo -->
  <div
    class="absolute top-4 left-4 z-50 flex items-center justify-center bg-white dark:bg-neutral-700 shadow-md rounded-full cursor-pointer transition-all">
    <img src="/images/auth.jpg" class="w-10 h-10 object-cover rounded-full shadow">
  </div>

  <!-- Sliding Card -->
  <div class="bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 
              p-8 shadow-2xl relative z-10 flex flex-col justify-center items-center
              w-full min-h-screen md:w-[45vw] md:min-h-[90vh] 
              md:rounded-3xl rounded-none
              md:absolute md:top-[5vh]
              transition-all duration-[700ms] ease-[cubic-bezier(0.68,-0.55,0.265,1.55)]" [ngClass]="{
          'md:left-[52.5vw]': position() === 'right',
          'md:left-[2.5vw]': position() === 'left'
       }">

    <div class="w-full max-w-xl mx-auto">

      <!-- Animated Content Switch -->
      <div [@fadeSwitch]="mode()">

        <!-- ======================== -->
        <!--        FORM MODES        -->
        <!-- ======================== -->
        @if (mode() === 'login' || mode() === 'register' ||
        mode() === 'forgot-password' || mode() === 'verify-email' ||
        (mode() === 'reset-password' && resetContext().token && resetContext().email)) {

        <form [formGroup]="authForm" (ngSubmit)="onSubmit()">

          <!-- ======================= -->
          <!--         TITLES          -->
          <!-- ======================= -->
          @if (mode() === 'login') {
          <h2 class="text-2xl font-semibold text-center mb-6">Welcome Back</h2>
          }
          @if (mode() === 'register') {
          <h2 class="text-2xl font-semibold text-center mb-6">Create an account</h2>
          }
          @if (mode() === 'forgot-password') {
          <h2 class="text-2xl font-semibold text-center mb-6">Reset Password</h2>
          }
          @if (mode() === 'reset-password') {
          <h2 class="text-2xl font-semibold text-center mb-6">Create a new password</h2>
          }
          @if (mode() === 'verify-email') {
          <h2 class="text-2xl font-semibold text-center mb-6">Verify Email</h2>
          }

          <!-- Google Button -->
          @if (mode() === 'login' || mode() === 'register') {
          <button type="button"
            class="w-full border border-neutral-300 dark:border-neutral-600 rounded-lg py-3 flex items-center justify-center gap-2 cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-700 transition mb-4">
            <i class="fa-brands fa-google text-red-500"></i>
            {{ mode() === 'login' ? 'Sign in with Google' : 'Create with Google' }}
          </button>

          <div class="flex items-center my-6">
            <hr class="flex-grow border-neutral-300 dark:border-neutral-600">
            <span class="px-3 text-neutral-500 dark:text-neutral-400">Or</span>
            <hr class="flex-grow border-neutral-300 dark:border-neutral-600">
          </div>
          }

          <!-- Descriptions -->
          @if (mode() === 'forgot-password') {
          <p class="text-neutral-500 dark:text-neutral-400 text-center mb-4">
            Enter your email and we'll send you a reset link.
          </p>
          }

          @if (mode() === 'reset-password') {
          <p class="text-neutral-500 dark:text-neutral-400 text-center mb-4">
            Resetting password for <strong>{{ resetContext().email }}</strong>.
          </p>
          }

          @if (mode() === 'verify-email') {
          <p class="text-neutral-500 dark:text-neutral-400 text-center mb-4">
            Enter the activation code sent to your email.
          </p>
          }

          <!-- Email -->
          @if (mode() !== 'verify-email' && mode() !== 'reset-password') {
          <label class="text-sm font-medium mb-1 block">Email Address</label>
          <input formControlName="email"
            class="w-full bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white rounded-lg py-3 px-4 border-2 border-transparent focus:border-orange-400 outline-none mb-1" />
          <div class="text-red-500 text-xs mt-1"
            *ngIf="authForm.get('email')?.touched && authForm.get('email')?.invalid">
            <span *ngIf="authForm.get('email')?.errors?.['required']">Email is required.</span>
            <span *ngIf="authForm.get('email')?.errors?.['email']">Enter a valid email.</span>
            <span *ngIf="authForm.get('email')?.errors?.['maxlength']">Email is too long.</span>
          </div>
          }

          <!-- Full Name -->
          @if (mode() === 'register') {
          <label class="text-sm font-medium mt-3 mb-1 block">Full Name</label>
          <input formControlName="fullName"
            class="w-full bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white rounded-lg py-3 px-4 border-2 border-transparent focus:border-orange-400 outline-none mb-1" />
          <div class="text-red-500 text-xs mt-1"
            *ngIf="authForm.get('fullName')?.touched && authForm.get('fullName')?.invalid">
            <span *ngIf="authForm.get('fullName')?.errors?.['required']">Full Name is required.</span>
            <span *ngIf="authForm.get('fullName')?.errors?.['minlength']">Full Name is too short.</span>
            <span *ngIf="authForm.get('fullName')?.errors?.['maxlength']">Full Name is too long.</span>
          </div>
          }

          <!-- Password -->
          @if (mode() === 'login' || mode() === 'register' || mode() === 'reset-password') {
          <label class="text-sm font-medium mt-3 mb-1 block">
            {{ mode() === 'reset-password' ? 'New Password' : 'Password' }}
          </label>
          <input type="password" formControlName="password"
            class="w-full bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white rounded-lg py-3 px-4 border-2 border-transparent focus:border-orange-400 outline-none mb-1" />
          <div class="text-red-500 text-xs mt-1"
            *ngIf="authForm.get('password')?.touched && authForm.get('password')?.invalid">
            <span *ngIf="authForm.get('password')?.errors?.['required']">Password is required.</span>
            <span *ngIf="authForm.get('password')?.errors?.['minlength']">Password must be at least 8 characters.</span>
            <span *ngIf="authForm.get('password')?.errors?.['pattern']">Password must contain uppercase, lowercase,
              number &
              symbol.</span>
          </div>
          }

          <!-- Confirm Password -->
          @if (mode() === 'register' || mode() === 'reset-password') {
          <label class="text-sm font-medium mt-3 mb-1 block">Confirm Password</label>
          <input type="password" formControlName="confirmPassword"
            class="w-full bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white rounded-lg py-3 px-4 border-2 border-transparent focus:border-orange-400 outline-none mb-1" />
          <div class="text-red-500 text-xs mt-1" *ngIf="(authForm.get('confirmPassword')?.touched || authForm.get('password')?.touched) &&
                        (authForm.get('confirmPassword')?.invalid || authForm.errors?.['mismatch'])">
            <span *ngIf="authForm.get('confirmPassword')?.errors?.['required']">Confirm Password is required.</span>
            <span *ngIf="authForm.errors?.['mismatch']">Passwords do not match.</span>
          </div>
          }

          <!-- Activation Code -->
          @if (mode() === 'verify-email') {
          <label class="text-sm font-medium mb-1 block">Activation Code</label>
          <input formControlName="code"
            class="w-full bg-neutral-100 dark:bg-neutral-700 text-neutral-900 dark:text-white rounded-lg py-3 px-4 border-2 border-transparent focus:border-orange-400 outline-none mb-1" />
          <div class="text-red-500 text-xs mt-1" *ngIf="authForm.get('code')?.touched && authForm.get('code')?.invalid">
            <span *ngIf="authForm.get('code')?.errors?.['required']">Activation code is required.</span>
            <span *ngIf="authForm.get('code')?.errors?.['minlength']">Code is too short.</span>
          </div>
          }

          <!-- Login-only: Remember/Forgot -->
          @if (mode() === 'login') {
          <div class="flex items-center justify-between mt-4 mb-4 text-sm font-medium">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" formControlName="rememberMe" class="w-4 h-4 accent-orange-400 cursor-pointer" />
              <span>Remember me</span>
            </label>
            <a (click)="switch('forgot-password')" class="text-orange-400 hover:underline cursor-pointer">Forgot
              Password?</a>
          </div>
          }


          <!-- Submit -->
          <button type="submit"
            class="mt-3 w-full py-3 rounded-full bg-orange-400 text-white font-semibold shadow-lg hover:bg-orange-500 active:bg-orange-600 transition disabled:opacity-60">
            @if (mode() === 'login') { Sign In }
            @if (mode() === 'register') { Create an account }
            @if (mode() === 'forgot-password') { Send Reset Link }
            @if (mode() === 'reset-password') { Save new password }
            @if (mode() === 'verify-email') { Verify Email }
          </button>


          <!-- Footer Switch Links -->
          <p class="text-center text-sm mt-4">
            @if (mode() === 'login') {
            Don't have an account?
            <a (click)="switch('register')" class="text-orange-400 hover:underline cursor-pointer">Sign up</a>
            }
            @if (mode() === 'register') {
            Already have an account?
            <a (click)="switch('login')" class="text-orange-400 hover:underline cursor-pointer">Sign in</a>
            }
            @if (mode() === 'forgot-password') {
            Remember your password?
            <a (click)="switch('login')" class="text-orange-400 hover:underline cursor-pointer">Back to Login</a>
            }
            @if (mode() === 'verify-email') {
            <a (click)="switch('login')" class="text-orange-400 hover:underline cursor-pointer">Back to Login</a>
            }
          </p>

        </form>
        }

        <!-- ======================= -->
        <!-- INVALID RESET PASSWORD -->
        <!-- ======================= -->
        @if (mode() === 'reset-password' && !(resetContext().token && resetContext().email)) {
        <div class="p-6 text-center">
          <h2 class="text-xl font-semibold">Reset link expired</h2>
          <p class="text-neutral-500 dark:text-neutral-400 mt-2 mb-4">
            Reset links only work for 30 minutes. Request a new one.
          </p>
          <button (click)="switch('forgot-password')"
            class="w-full py-3 rounded-full bg-orange-400 text-white font-semibold shadow-lg hover:bg-orange-500 transition">
            Request new link
          </button>
        </div>
        }

        <!-- ======================= -->
        <!-- VERIFY SUCCESS -->
        <!-- ======================= -->
        @if (mode() === 'verify-success') {
        <div class="p-10 text-center">
          <div class="text-5xl mb-4">âœ¨</div>
          <h2 class="text-2xl font-semibold">Account activated!</h2>
          <p class="text-neutral-500 dark:text-neutral-400 mt-3 mb-6">
            Your email is verified. Welcome aboard!
          </p>
          <button (click)="switch('login')"
            class="w-full py-3 rounded-full bg-orange-400 text-white font-semibold shadow-lg hover:bg-orange-500 transition">
            Go to Login
          </button>
        </div>
        }

      </div>

    </div>

  </div>
</div>